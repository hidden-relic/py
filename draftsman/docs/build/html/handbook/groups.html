<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Groups &mdash; factorio-draftsman 0.3.5 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/draftsman_icon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to use mods with Draftsman" href="modding.html" />
    <link rel="prev" title="Entities" href="entities.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> factorio-draftsman
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#creating-a-blueprint">Creating a Blueprint</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#adding-entities">Adding Entities</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Handbook</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="blueprints.html">Blueprints</a><ul>
<li class="toctree-l3"><a class="reference internal" href="blueprints.html#differences-between-a-blueprint-object-and-a-json-dict">Differences between a Blueprint object and a JSON dict</a></li>
<li class="toctree-l3"><a class="reference internal" href="blueprints.html#manipulating-entities-inside-of-blueprints">Manipulating Entities inside of Blueprints</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="entities.html">Entities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="entities.html#entity-attributes">Entity Attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="entities.html#entity-ids">Entity IDs</a></li>
<li class="toctree-l3"><a class="reference internal" href="entities.html#entity-associations">Entity Associations</a></li>
<li class="toctree-l3"><a class="reference internal" href="entities.html#entity-vs-entitylike"><code class="docutils literal notranslate"><span class="pre">Entity</span></code> vs. <code class="docutils literal notranslate"><span class="pre">EntityLike</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="entities.html#entity-merging">Entity Merging</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Groups</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#outline-of-the-problem">Outline of the problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="#structure-of-the-solution">Structure of the Solution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implementation-overview">Implementation Overview</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="modding.html">How to use mods with Draftsman</a><ul>
<li class="toctree-l3"><a class="reference internal" href="modding.html#installing-mods">Installing mods</a></li>
<li class="toctree-l3"><a class="reference internal" href="modding.html#writing-scripts-with-mods">Writing scripts with mods</a></li>
<li class="toctree-l3"><a class="reference internal" href="modding.html#limitations-of-mods">Limitations of mods</a></li>
<li class="toctree-l3"><a class="reference internal" href="modding.html#potential-errors">Potential Errors</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/blueprintable.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">blueprintable</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/constants.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">constants</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/entity.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">entity</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/env.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">env</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/error.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">error</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/signatures.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">signatures</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/tile.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tile</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/utils.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">utils</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/utils.html#abstract-shape-classes">Abstract Shape Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/utils.html#encoding-decoding-operations">Encoding/Decoding Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/utils.html#vector-operations">Vector Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/utils.html#collision-functions">Collision Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/utils.html#miscellaneous">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/warning.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">warning</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/classes/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">classes</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/classes/association.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">association</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/classes/blueprint.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">blueprint</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/classes/blueprintbook.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">blueprintbook</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/classes/collection.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">collection</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/classes/collisionset.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">collisionset</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/classes/entity.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">entity</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/classes/entitylike.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">entitylike</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/classes/entitylist.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">entitylist</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/classes/group.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">group</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/classes/spatial_data_structure.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spatial_data_structure</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/classes/spatial_hashmap.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spatial_hashmap</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/classes/spatiallike.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spatiallike</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/classes/tile.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tile</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/classes/tilelist.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tilelist</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/classes/transformable.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">transformable</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/classes/vector.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vector</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/classes/mixins/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mixins</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/circuit_condition.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">circuit_condition</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/circuit_connectable.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">circuit_connectable</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/circuit_read_contents.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">circuit_read_contents</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/circuit_read_hand.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">circuit_read_hand</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/circuit_read_resource.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">circuit_read_resource</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/color.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">color</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/control_behavior.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">control_behavior</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/directional.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">directional</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/double_grid_aligned.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">double_grid_aligned</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/eight_way_directional.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">eight_way_directional</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/enable_disable.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">enable_disable</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/filters.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">filters</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/inventory_filter.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">inventory_filter</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/inventory.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">inventory</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/io_type.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">io_type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/logistic_condition.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">logistic_condition</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/mode_of_operation.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mode_of_operation</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/modules.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">modules</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/orientation.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">orientation</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/power_connectable.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">power_connectable</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/read_rail_signal.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">read_rail_signal</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/recipe.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">recipe</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/request_filters.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">request_filters</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/request_items.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">request_items</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/classes/mixins/stack_size.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">stack_size</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/data/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">data</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/data/entities.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">entities</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/data/instruments.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">instruments</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/data/items.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">items</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/data/mods.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mods</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/data/modules.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">modules</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/data/recipes.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">recipes</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/data/signals.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">signals</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/data/tiles.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tiles</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/prototypes/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">prototypes</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/accumulator.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">accumulator</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/arithmetic_combinator.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">arithmetic_combinator</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/artillery_wagon.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">artillery_wagon</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/assembling_machine.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">assembling_machine</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/beacon.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">beacon</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/boiler.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">boiler</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/burner_generator.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">burner_generator</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/cargo_wagon.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cargo_wagon</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/constant_combinator.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">constant_combinator</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/container.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">container</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/curved_rail.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">curved_rail</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/decider_combinator.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">decider_combinator</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/electric_energy_interface.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">electric_energy_interface</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/electric_pole.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">electric_pole</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/filter_inserter.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">filter_inserter</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/fluid_wagon.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fluid_wagon</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/furnace.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">furnace</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/gate.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">gate</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/generator.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">generator</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/heat_interface.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">heat_interface</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/heat_pipe.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">heat_pipe</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/infinity_container.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">infinity_container</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/infinity_pipe.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">infinity_pipe</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/inserter.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">inserter</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/lab.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">lab</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/lamp.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">lamp</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/land_mine.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">land_mine</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/linked_belt.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">linked_belt</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/linked_container.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">linked_container</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/loader.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">loader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/locomotive.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">locomotive</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/logistic_active_container.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">logistic_active_container</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/logistic_buffer_container.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">logistic_buffer_container</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/logistic_passive_container.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">logistic_passive_container</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/logistic_request_container.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">logistic_request_container</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/logistic_storage_container.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">logistic_storage_container</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/mining_drill.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mining_drill</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/offshore_pump.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">offshore_pump</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/pipe.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pipe</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/power_switch.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">power_switch</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/programmable_speaker.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">programmable_speaker</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/pump.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pump</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/radar.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">radar</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/rail_chain_signal.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">rail_chain_signal</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/rail_signal.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">rail_signal</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/reactor.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">reactor</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/roboport.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">roboport</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/rocket_silo.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">rocket_silo</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/solar_panel.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">solar_panel</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/splitter.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">splitter</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/storage_tank.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">storage_tank</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/straight_rail.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">straight_rail</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/train_stop.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">train_stop</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/transport_belt.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">transport_belt</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/turret.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">turret</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/underground_belt.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">underground_belt</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/underground_pipe.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">underground_pipe</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/prototypes/wall.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">wall</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">factorio-draftsman</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Handbook</a> &raquo;</li>
      <li>Groups</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/handbook/groups.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="groups">
<h1>Groups<a class="headerlink" href="#groups" title="Permalink to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p><a class="reference internal" href="../reference/classes/group.html#draftsman.classes.group.Group" title="draftsman.classes.group.Group"><code class="xref py py-class docutils literal notranslate"><span class="pre">Group</span></code></a> classes in Draftsman are one of it’s most powerful features.
Groups allow you to create “sub-blueprints” that can be placed inside a blueprint multiple times, or even inside other Group objects.
This allows the user to fragment blueprints into unique, discrete components that can be specified once and then reused multiple times, reducing repetitive code and improving readability.
The ability to use Groups was one of the core design pillars of Draftsman when it was originally made, and was present in the very first prototypes of the module.</p>
<p>To illustrate how to use Groups and in what ways they are useful, I’ll use the problem that originally sparked the construction of the entire module in the first place; a design for a combinator computer 32-bit Read-only Memory.
This problem is already solved with an implementation in the <a class="reference external" href="https://github.com/redruin1/factorio-draftsman/blob/main/examples/1KiB_sector_ROM.py">examples folder here</a> , if you want to take a look at just the raw implementation.
The rest of this page will be an outline of the problem and a walkthrough of the source, piece-by-piece.</p>
</section>
<section id="outline-of-the-problem">
<h2>Outline of the problem<a class="headerlink" href="#outline-of-the-problem" title="Permalink to this heading"></a></h2>
<p>I wanted a compact signal storage medium for a revision of my combinator computer.
I had 3 primary restrictions:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>I wanted the output signals from the ROM to be true 32-bit numbers.</p></li>
<li><p>I wanted to be able to query from 2 places in the ROM simultaneously.</p></li>
<li><p>I wanted the data storage to be as spatially compact as possible.</p></li>
</ol>
</div></blockquote>
<p>The most compact way to store data in constant combinators to fill every slot with a different signal type and a signal filter apparatus to only pass through the signal or signals that you want.
The trouble with this is that if you want the filtering process to be fast, the most reliable and simple way to achieve this is to reserve a bit in the number to act as a filter flag, and only output the signals that have that bit set:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>|v-- ---- ---- ---- ---- ---- ---- ----
0100 0000 0000 0000 0000 0000 0000 0000

&#39;|&#39; = sign bit
&#39;v&#39; = filter bit
&#39;-&#39; = data bit
&#39; &#39; = unused
</pre></div>
</div>
<p>The following example actually requires 2 bits to operate, as a limitation of the decider combinator not being able to check a single bit.</p>
<img alt="../_images/simple_rom_principle.png" src="../_images/simple_rom_principle.png" />
<p>This is fast and works, though it violates the primary restriction; <em>true</em> 32-bit numbers.
No matter which way you work around it, in order to have 32 data bits and at least 1 bit flag to determine which signal to output, you need at minimum 33 bits per data signal, which butts against the limitation of signals in Factorio being only 32-bits in size.</p>
<p>Well, if you can’t fit 33 bits in one signal, you can certainly fit them in <em>2</em> signals.
A solution to this is to simply split the data signal into 2 parts, store them internally as those 2 parts, and then recombine them on output.
For simplicities sake, I split the data into the lower 16 bits and the higher 16 bits, which are known as <strong>low</strong> and <strong>high</strong>, respectively:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Low bits:
|v                  ---- ---- ---- ----
0100 0000 0000 0000 1111 1111 1111 1111

High bits:
|v                  ---- ---- ---- ----
0100 0000 0000 0000 1111 1111 1111 1111

&#39;|&#39; = sign bit
&#39;v&#39; = filter bit
&#39;-&#39; = data bit
&#39; &#39; = unused
</pre></div>
</div>
<p>Recombination is simple; The low bits pass through a simple AND of the lower 16 bits of the number to get rid of the filter bit, and the high bits are left shifted 16 spots, also removing the filter bit. The two numbers can be added together on a single wire, since none of their bits overlap, meaning the recombination only has a delay of 1 tick.</p>
<img alt="../_images/split_rom_principle.png" src="../_images/split_rom_principle.png" />
<p>In order to read from two places at once, I doubled the above logic to take two address signals, labeled as <strong>A</strong> and <strong>B</strong>.
In addition, we also need to link sectors in parallel, which means that we need to determine which cluster of combinators to read from, and how to differentiate between each set.
To do this, we introduces another signal to specify which sector to read from:</p>
<img alt="../_images/almost_final_design.png" src="../_images/almost_final_design.png" />
<p>Add some more combinators for a max of 256 signals for each “sector”, and some logic for converting a numeric address signal to a signal type and sector number, and you get the final working design:</p>
<img alt="../_images/final_design.png" src="../_images/final_design.png" />
<p>This works well, and is <em>very</em> dense; A row of 4 sectors can hold literal kilobytes of data, 4 KiB per row, all in a data space of only 16 x 11 tiles.
If you only need 30-bits per number this density could probably almost be doubled, assuming you can figure out the proper interface for it.</p>
<p>However, this manner of storing data is difficult to populate by hand, to say the least. Manually ANDing and shifting a number in a calculator, plus the manner of placing 2 separate signals, while ensuring that they must have the same type in 2 different places with 2 different values, made the design unviable to use by hand despite it’s benefits.
Of course, this process would be <em>very simple</em> if I could just get a computer to do it for me… Hence, Draftsman.</p>
</section>
<section id="structure-of-the-solution">
<h2>Structure of the Solution<a class="headerlink" href="#structure-of-the-solution" title="Permalink to this heading"></a></h2>
<p>The basic design can be broken up into a set of unique parts, each one performing a specific function:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>An <strong>encoder</strong>, or a circuit to take the address line of the ROM to read and send the appropriate signals to the sectors;</p></li>
<li><p>One or more <strong>sectors</strong>, which are where the actual data is stored, which output the high and low bit values across separate output lines, for both address <em>A</em> and address <em>B</em>;</p></li>
<li><p>And a <strong>decoder</strong>, which takes the 4 <em>high</em> and <em>low</em> output lines, 2 for <em>A</em> and 2 for <em>B</em>, and recombines them to 2 constant signals each with the correct 32-bit value.</p></li>
</ol>
</div></blockquote>
<img alt="../_images/final_design_highlighted.png" src="../_images/final_design_highlighted.png" />
<p>Further, an individual <strong>sector</strong> can be discretized into multiple parts of its own:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>The “cell” of constant combinators holding the <strong>low</strong> bits;</p></li>
<li><p>The “cell” of constant combinators holding the <strong>high</strong> bits;</p></li>
<li><p><strong>Gate</strong> combinators that determine whether or not to output the data from this <strong>sector</strong>;</p></li>
<li><p>And <strong>Selector</strong> combinators that filter the contents from the <strong>gates</strong> and output only the types of signal filtered by the <strong>encoder</strong>.</p></li>
</ol>
</div></blockquote>
<img alt="../_images/sector_highlighted.png" src="../_images/sector_highlighted.png" />
<p>Hopefully you can start to see the naturalness of specifying each component as a Group object; Only the position and the data stored changes between each sector.
It makes sense that we should be able to construct a single sector, connections and all, and then simply copy-paste the object, only changing a few attributes each time.
Groups will allow us to do exactly this.</p>
</section>
<section id="implementation-overview">
<h2>Implementation Overview<a class="headerlink" href="#implementation-overview" title="Permalink to this heading"></a></h2>
<p>The first thing we do to aid in clarity is to create a custom <a class="reference internal" href="../reference/classes/entitylike.html#draftsman.classes.entitylike.EntityLike" title="draftsman.classes.entitylike.EntityLike"><code class="xref py py-class docutils literal notranslate"><span class="pre">EntityLike</span></code></a> that is a child of <a class="reference internal" href="../reference/classes/group.html#draftsman.classes.group.Group" title="draftsman.classes.group.Group"><code class="xref py py-class docutils literal notranslate"><span class="pre">Group</span></code></a>, called <code class="docutils literal notranslate"><span class="pre">CombinatorCell</span></code>.
The description provided is fairly self-explanatory:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CombinatorCell</span><span class="p">(</span><span class="n">Group</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Regular grid of constant combinators populated with data and linked</span>
<span class="sd">    together. Allows the user to set their data in bulk, acting like a single</span>
<span class="sd">    combined constant combinator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>In our way of looking at the problem, each individual constant combinator is irrelevant; in actuality they act as one big one that has all the signals we need, one for the set of low signals and one for the set of high signals.
Since we treat them as one singular entity, it makes sense to group them all together and treat it as a single object that has a single position and a single set of data.
<code class="docutils literal notranslate"><span class="pre">CombinatorCell</span></code> only has 2 methods, an <code class="docutils literal notranslate"><span class="pre">__init__</span></code> function and <code class="docutils literal notranslate"><span class="pre">set_data</span></code>, which sets the contents of the cell’s combinators.
The first half of <code class="docutils literal notranslate"><span class="pre">__init__</span></code> is fairly straightforward:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="nb">id</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;combinator-cell&quot;</span><span class="p">,</span>
    <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">dimension</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">wire_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="c1"># Initialize parent (Group)</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">CombinatorCell</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">)</span>

    <span class="c1"># ID of the cell. Required</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>

    <span class="c1"># Name of the entity. Can be used if you want to specify different types</span>
    <span class="c1"># of CombinatorCell with the same class.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="c1"># Type of the entity. Here we set it to constant-combinator, so that any</span>
    <span class="c1"># queries on the blueprint for constant-combinators will also return</span>
    <span class="c1"># these objects.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="s2">&quot;constant-combinator&quot;</span>
    <span class="c1"># Name of the constant combinator. Can be substitued with a modded one,</span>
    <span class="c1"># but the design would have to change if it was a different dimension.</span>
    <span class="n">combinator_name</span> <span class="o">=</span> <span class="s2">&quot;constant-combinator&quot;</span>
    <span class="c1"># position (will be the top left corner)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span>
    <span class="c1"># width and height of the grid, from top left to bottom right</span>
    <span class="c1"># self._tile_width, self._tile_height = dimension</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">Direction</span><span class="o">.</span><span class="n">NORTH</span>  <span class="c1"># Default</span>
    <span class="k">if</span> <span class="s2">&quot;direction&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>  <span class="c1"># Optional</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;direction&quot;</span><span class="p">]</span>

    <span class="n">comb</span> <span class="o">=</span> <span class="n">ConstantCombinator</span><span class="p">(</span><span class="n">combinator_name</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="p">)</span>

    <span class="c1"># Match the collision mask with the sub-entities</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_collision_mask</span> <span class="o">=</span> <span class="n">comb</span><span class="o">.</span><span class="n">collision_mask</span>

    <span class="c1"># number of signal slots per combinator</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">item_slot_count</span> <span class="o">=</span> <span class="n">comb</span><span class="o">.</span><span class="n">item_slot_count</span>

    <span class="c1"># ...</span>
</pre></div>
</div>
<p>Here, we set up a selection of metadata about the object.
The <code class="docutils literal notranslate"><span class="pre">id</span></code> attribute is important, as it will be one of the keys to access the constant combinators associated with the entity.
We also create a local constant combinator instance <code class="docutils literal notranslate"><span class="pre">comb</span></code> specified using the <code class="docutils literal notranslate"><span class="pre">combinator_name</span></code>, which allows us to specify a different constant combinator, if one was available.
We also keep track of <code class="docutils literal notranslate"><span class="pre">item_slot_count</span></code>, which we’ll need for <code class="docutils literal notranslate"><span class="pre">set_data</span></code> later.</p>
<p>The second half of <code class="docutils literal notranslate"><span class="pre">__init__</span></code> creates a grid of combinators specified by <code class="docutils literal notranslate"><span class="pre">dimension</span></code>, from top-left to bottom-right in rows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ...</span>

<span class="c1"># Keep a list of combinators in the grid</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">comb</span><span class="o">.</span><span class="n">tile_position</span> <span class="o">=</span> <span class="p">((</span><span class="n">i</span> <span class="o">*</span> <span class="n">comb</span><span class="o">.</span><span class="n">tile_width</span><span class="p">),</span> <span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">comb</span><span class="o">.</span><span class="n">tile_height</span><span class="p">))</span>
        <span class="n">comb</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comb</span><span class="p">)</span>

<span class="c1"># Connect all the combinators to each other</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">across</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_circuit_connection</span><span class="p">(</span><span class="n">wire_color</span><span class="p">,</span> <span class="n">current</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">across</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">below</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_circuit_connection</span><span class="p">(</span><span class="n">wire_color</span><span class="p">,</span> <span class="n">current</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">below</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
</pre></div>
</div>
<p>Each ID of the combinators is set to it’s position in the grid, as a string of the format <code class="docutils literal notranslate"><span class="pre">&quot;x_y&quot;</span></code>, starting at 0.
This means that the top left combinator of the cell would have the ID <code class="docutils literal notranslate"><span class="pre">&quot;0_0&quot;</span></code> and would be accessed as such.
Each entity is added to the <code class="docutils literal notranslate"><span class="pre">entities</span></code> list (which is inherited by <code class="docutils literal notranslate"><span class="pre">Group</span></code>) and is connected in a regular grid to it’s neighbours, cementing them together in the same signal network.</p>
<p>The only other function we need is <code class="docutils literal notranslate"><span class="pre">set_data</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets the data in the cell. Starts in the top-right combinator, then goes</span>
<span class="sd">    across and down, filling each combinator&#39;s entry with the signal</span>
<span class="sd">    specified by `mapping` and the value specified by `data`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_slot_count</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_width</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_height</span>

    <span class="k">for</span> <span class="n">combinator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">:</span>
        <span class="n">combinator</span><span class="o">.</span><span class="n">set_signals</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">current_combinator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_slot_count</span><span class="p">)]</span>
        <span class="c1"># Only set the signal if it&#39;s nonzero to save space</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">current_combinator</span><span class="o">.</span><span class="n">set_signal</span><span class="p">(</span>
                <span class="n">i</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_slot_count</span><span class="p">,</span> <span class="n">mapping</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">value</span>
            <span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">mapping</span></code> is a list of signal names, which correspond to each unique signal that we need to encode the data, while <code class="docutils literal notranslate"><span class="pre">data</span></code> is the actual values of each signal to set.
Assertions are made to ensure that we don’t have more data than we have unique signals, and that the total number of combinators in this grid can actually hold the number of signals that we set.
Then the signal contents of all the combinators are wiped and then set with the signal names and values sequentially starting with the top-leftmost combinator.
Because signals that have a value of zero are still inserted into the combinator (which makes the output blueprint more complex), in order to reduce bloating of the final blueprint string we only set signals that are non-zero.</p>
<p>We can now use this class to create a rectangular grid of constant combinators of any size, filled with any data.
Useful, particularly if one might need to create other ROM designs in the future.
Let’s use this to create the final blueprint.</p>
<p>Before we can start placing entities, we need to create that signal <code class="docutils literal notranslate"><span class="pre">mapping</span></code> list mentioned before.
This is fairly straightforward; the following is specified in the <code class="docutils literal notranslate"><span class="pre">main()</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify the interface signals:</span>
<span class="n">address_signal</span> <span class="o">=</span> <span class="s2">&quot;red-wire&quot;</span>
<span class="n">sector_index_signal</span> <span class="o">=</span> <span class="s2">&quot;green-wire&quot;</span>

<span class="c1"># Blacklist desired signals:</span>
<span class="n">blacklist</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># There are 262 valid vanilla signals in the game</span>
<span class="c1"># We can&#39;t use the special signals in constant combinators</span>
<span class="n">blacklist</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;signal-anything&quot;</span><span class="p">,</span> <span class="s2">&quot;signal-everything&quot;</span><span class="p">,</span> <span class="s2">&quot;signal-each&quot;</span><span class="p">]</span>
<span class="c1"># And the interface signals have to be different by nature of this blueprint</span>
<span class="n">blacklist</span> <span class="o">+=</span> <span class="p">[</span><span class="n">address_signal</span><span class="p">,</span> <span class="n">sector_index_signal</span><span class="p">]</span>
<span class="c1"># Which leaves us with 1 spare signal that we can choose to avoid</span>
<span class="c1"># (unless you&#39;re using mods)</span>
<span class="n">blacklist</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;signal-info&quot;</span><span class="p">]</span>

<span class="c1"># Generate the signal mapping set</span>
<span class="n">mapping</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">add_signals_to_mapping</span><span class="p">(</span><span class="n">signals</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">signal</span> <span class="ow">in</span> <span class="n">signals</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">signal</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">blacklist</span><span class="p">:</span>
            <span class="n">mapping</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">signal</span><span class="p">)</span>

<span class="n">add_signals_to_mapping</span><span class="p">(</span><span class="n">signals</span><span class="o">.</span><span class="n">virtual</span><span class="p">)</span>
<span class="n">add_signals_to_mapping</span><span class="p">(</span><span class="n">signals</span><span class="o">.</span><span class="n">item</span><span class="p">)</span>
<span class="n">add_signals_to_mapping</span><span class="p">(</span><span class="n">signals</span><span class="o">.</span><span class="n">fluid</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">256</span>
</pre></div>
</div>
<p>We first construct a blacklist of signals that we either cannot use (the pure-virtual signals), are already used by the blueprint (<code class="docutils literal notranslate"><span class="pre">address_signal</span></code> or <code class="docutils literal notranslate"><span class="pre">sector_index_signal</span></code>), or do not want to use (such as <code class="docutils literal notranslate"><span class="pre">&quot;signal-info&quot;</span></code>, because I use it frequently in other circuitry).
We then iterate over all signals, adding them in order to the <code class="docutils literal notranslate"><span class="pre">mapping</span></code> list if they’re not a member of the blacklist.</p>
<p>Now that we have the mapping of signals, we can actually start creating a sector object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sectors are akin to Hard-drive sectors and are where the data is stored</span>
<span class="n">sector</span> <span class="o">=</span> <span class="n">Group</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;sector_0&quot;</span><span class="p">)</span>

<span class="c1"># Each sector has 4 gates and 4 selectors, 2 for low &amp; high and 2 for A &amp; B</span>
<span class="c1"># Selectors select which the correct signal from the 256 signals from the</span>
<span class="c1"># sector</span>
<span class="n">selector</span> <span class="o">=</span> <span class="n">DeciderCombinator</span><span class="p">(</span><span class="s2">&quot;decider-combinator&quot;</span><span class="p">)</span>
<span class="n">selector</span><span class="o">.</span><span class="n">set_decider_conditions</span><span class="p">(</span><span class="s2">&quot;signal-each&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">29</span><span class="p">,</span> <span class="s2">&quot;signal-each&quot;</span><span class="p">)</span>
<span class="n">selector</span><span class="o">.</span><span class="n">copy_count_from_input</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">selector_ids</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;low_selector_a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;low_selector_b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;high_selector_a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;high_selector_b&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">selector_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">selector_ids</span><span class="p">):</span>
    <span class="n">selector</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">selector_id</span>
    <span class="n">selector</span><span class="o">.</span><span class="n">tile_position</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">sector</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>

<span class="c1"># Gates determine which sector the address line is reading from and pass to</span>
<span class="c1"># the selectors</span>
<span class="n">gate</span> <span class="o">=</span> <span class="n">DeciderCombinator</span><span class="p">(</span><span class="s2">&quot;decider-combinator&quot;</span><span class="p">)</span>
<span class="n">gate</span><span class="o">.</span><span class="n">set_decider_conditions</span><span class="p">(</span><span class="n">sector_index_signal</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;signal-everything&quot;</span><span class="p">)</span>
<span class="n">gate</span><span class="o">.</span><span class="n">copy_count_from_input</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">gate_ids</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;low_gate_a&quot;</span><span class="p">,</span> <span class="s2">&quot;low_gate_b&quot;</span><span class="p">,</span> <span class="s2">&quot;high_gate_a&quot;</span><span class="p">,</span> <span class="s2">&quot;high_gate_b&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">gate_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gate_ids</span><span class="p">):</span>
    <span class="n">gate</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">gate_id</span>
    <span class="n">gate</span><span class="o">.</span><span class="n">tile_position</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">sector</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="p">)</span>

<span class="c1"># Low cell</span>
<span class="n">cell</span> <span class="o">=</span> <span class="n">CombinatorCell</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">cell</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">sector</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>

<span class="c1"># High cell</span>
<span class="n">cell</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s2">&quot;high&quot;</span>
<span class="n">cell</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">sector</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>

<span class="c1">### Internal sector connections ###</span>
<span class="c1"># Gate inputs</span>
<span class="n">sector</span><span class="o">.</span><span class="n">add_circuit_connection</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;0_0&quot;</span><span class="p">),</span> <span class="s2">&quot;low_gate_a&quot;</span><span class="p">)</span>
<span class="n">sector</span><span class="o">.</span><span class="n">add_circuit_connection</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;low_gate_a&quot;</span><span class="p">,</span> <span class="s2">&quot;low_gate_b&quot;</span><span class="p">)</span>
<span class="n">sector</span><span class="o">.</span><span class="n">add_circuit_connection</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;0_0&quot;</span><span class="p">),</span> <span class="s2">&quot;high_gate_a&quot;</span><span class="p">)</span>
<span class="n">sector</span><span class="o">.</span><span class="n">add_circuit_connection</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;high_gate_a&quot;</span><span class="p">,</span> <span class="s2">&quot;high_gate_b&quot;</span><span class="p">)</span>

<span class="n">sector</span><span class="o">.</span><span class="n">add_circuit_connection</span><span class="p">(</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;low_gate_a&quot;</span><span class="p">,</span> <span class="s2">&quot;high_gate_a&quot;</span><span class="p">)</span>
<span class="n">sector</span><span class="o">.</span><span class="n">add_circuit_connection</span><span class="p">(</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;low_gate_b&quot;</span><span class="p">,</span> <span class="s2">&quot;high_gate_b&quot;</span><span class="p">)</span>

<span class="c1"># Selector inputs</span>
<span class="n">sector</span><span class="o">.</span><span class="n">add_circuit_connection</span><span class="p">(</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;low_gate_a&quot;</span><span class="p">,</span> <span class="s2">&quot;low_selector_a&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">sector</span><span class="o">.</span><span class="n">add_circuit_connection</span><span class="p">(</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;low_gate_b&quot;</span><span class="p">,</span> <span class="s2">&quot;low_selector_b&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">sector</span><span class="o">.</span><span class="n">add_circuit_connection</span><span class="p">(</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;high_gate_a&quot;</span><span class="p">,</span> <span class="s2">&quot;high_selector_a&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">sector</span><span class="o">.</span><span class="n">add_circuit_connection</span><span class="p">(</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;high_gate_b&quot;</span><span class="p">,</span> <span class="s2">&quot;high_selector_b&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">sector</span><span class="o">.</span><span class="n">add_circuit_connection</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;low_selector_a&quot;</span><span class="p">,</span> <span class="s2">&quot;high_selector_a&quot;</span><span class="p">)</span>
<span class="n">sector</span><span class="o">.</span><span class="n">add_circuit_connection</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;low_selector_b&quot;</span><span class="p">,</span> <span class="s2">&quot;high_selector_b&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note how we only specify one of each type of <code class="docutils literal notranslate"><span class="pre">EntityLike</span></code>; each time an entity is added to an entity list, it is copied as a unique object.
This how we get away with only specifying each entity once, and then changing their attributes for repeated additions.
Each entity is added not to the root blueprint, but instead to the <code class="docutils literal notranslate"><span class="pre">sector</span></code> group.
Note also that the positions are in positions local to the Group itself; and are specified around the origin.
These positions become offset with the group’s position when it’s added to the root blueprint, or other groups.
You can see this nesting behavior with <code class="docutils literal notranslate"><span class="pre">CombinatorCell</span></code>, which itself is a thin wrapper around <code class="docutils literal notranslate"><span class="pre">Group</span></code>; combinators are specified in coordinates local to <code class="docutils literal notranslate"><span class="pre">CombinatorCell</span></code>, of which the <code class="docutils literal notranslate"><span class="pre">CombinatorCell</span></code>’s position is in terms of the parent sector <code class="docutils literal notranslate"><span class="pre">Group</span></code> position.
These positions are resolved to absolute positions when the Blueprint is converted to a JSON <code class="docutils literal notranslate"><span class="pre">dict</span></code> and exported as a string for use in Factorio.
Sector connections are also specified, and will persist for each Group every time it is added to a parent object.</p>
<p>Next the actual sectors are placed in rows of 4, the exact amount depending on the total number of data to encode.
It’s limited to 4 so that substations can be comfortably placed across their width.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ...</span>

<span class="c1"># We generate the blueprint in rows of 4 sectors (4 KiB) and expand as</span>
<span class="c1"># needed</span>
<span class="n">num_rows</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="mi">256</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">num_sectors</span> <span class="o">=</span> <span class="n">num_rows</span> <span class="o">*</span> <span class="mi">4</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_sectors</span><span class="p">):</span>
    <span class="n">sector</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s2">&quot;sector_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="n">sector_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">256</span> <span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">256</span><span class="p">]</span>
    <span class="c1"># Set low bits</span>
    <span class="n">sector</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sector_data</span><span class="p">])</span>
    <span class="n">sector</span><span class="o">.</span><span class="n">entities</span><span class="p">[(</span><span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;1_6&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">set_signal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sector_index_signal</span><span class="p">,</span> <span class="o">-</span><span class="n">i</span><span class="p">)</span>

    <span class="c1"># Set high bits</span>
    <span class="n">sector</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sector_data</span><span class="p">])</span>
    <span class="n">sector</span><span class="o">.</span><span class="n">entities</span><span class="p">[(</span><span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;1_6&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">set_signal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sector_index_signal</span><span class="p">,</span> <span class="o">-</span><span class="n">i</span><span class="p">)</span>

    <span class="c1"># We restrict the width to 4 to fit between substations</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">sector</span><span class="o">.</span><span class="n">tile_width</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">sector</span><span class="o">.</span><span class="n">tile_height</span>
    <span class="n">sector</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="n">blueprint</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sector</span><span class="p">)</span>

<span class="c1"># ...</span>
</pre></div>
</div>
<p>The sector’s ID is set, a subset of the data extracted to be encoded.
The low bits are accessed with the string <code class="docutils literal notranslate"><span class="pre">&quot;low&quot;</span></code>, which corresponds to the <code class="docutils literal notranslate"><span class="pre">CombinatorCell</span></code> object, where it’s data is set to the low bits of the data.
Then, the bottom right combinator of the grid (<code class="docutils literal notranslate"><span class="pre">&quot;1_6&quot;</span></code>) is set to have the negative value of the sector index signal, which allows the circuit to differentiate between sectors.
The syntax <code class="docutils literal notranslate"><span class="pre">sector.entities[(&quot;low&quot;,</span> <span class="pre">&quot;1_6&quot;)]</span></code> is shorthand, and is equivalent to <code class="docutils literal notranslate"><span class="pre">sector.entities[&quot;low&quot;].entities[&quot;1_6&quot;]</span></code>.
This format works with any entity that has a custom <code class="docutils literal notranslate"><span class="pre">entities</span></code> attribute that is an <a class="reference internal" href="../reference/classes/entitylist.html#draftsman.classes.entitylist.EntityList" title="draftsman.classes.entitylist.EntityList"><code class="xref py py-class docutils literal notranslate"><span class="pre">EntityList</span></code></a>, which also includes <a class="reference internal" href="../reference/classes/blueprint.html#draftsman.classes.blueprint.Blueprint" title="draftsman.classes.blueprint.Blueprint"><code class="xref py py-class docutils literal notranslate"><span class="pre">Blueprint</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example code</span>
<span class="n">cell</span> <span class="o">=</span> <span class="n">CombinatorCell</span><span class="p">(</span><span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">sector</span> <span class="o">=</span> <span class="n">Group</span><span class="p">(</span><span class="s2">&quot;sector_0&quot;</span><span class="p">)</span>
<span class="n">sector</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>

<span class="n">blueprint</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">()</span>
<span class="n">blueprint</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sector</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="s2">&quot;0_0&quot;</span><span class="p">],</span> <span class="n">ConstantCombinator</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sector</span><span class="o">.</span><span class="n">entities</span><span class="p">[(</span><span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;0_0&quot;</span><span class="p">)],</span> <span class="n">ConstantCombinator</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">blueprint</span><span class="o">.</span><span class="n">entities</span><span class="p">[(</span><span class="s2">&quot;sector_0&quot;</span><span class="p">,</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;0_0&quot;</span><span class="p">)],</span> <span class="n">ConstantCombinator</span><span class="p">)</span>
</pre></div>
</div>
<p>This format also works when establishing connections as well:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1KiB_sector_ROM.py</span>

<span class="c1"># ...</span>

<span class="c1">### Connections between sectors ###</span>
<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_rows</span><span class="p">):</span>
    <span class="c1"># Row connections</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">x</span>
        <span class="n">left_sector</span> <span class="o">=</span> <span class="s2">&quot;sector_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">right_sector</span> <span class="o">=</span> <span class="s2">&quot;sector_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># fmt: off</span>
        <span class="n">row_connections</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c1"># Inputs</span>
            <span class="p">[</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">left_sector</span><span class="p">,</span> <span class="s2">&quot;high_gate_a&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">right_sector</span><span class="p">,</span> <span class="s2">&quot;low_gate_a&quot;</span><span class="p">)],</span>
            <span class="p">[</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">left_sector</span><span class="p">,</span> <span class="s2">&quot;high_gate_b&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">right_sector</span><span class="p">,</span> <span class="s2">&quot;low_gate_b&quot;</span><span class="p">)],</span>
            <span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">left_sector</span><span class="p">,</span> <span class="s2">&quot;high_selector_a&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">right_sector</span><span class="p">,</span> <span class="s2">&quot;low_selector_a&quot;</span><span class="p">)],</span>
            <span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">left_sector</span><span class="p">,</span> <span class="s2">&quot;high_selector_b&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">right_sector</span><span class="p">,</span> <span class="s2">&quot;low_selector_b&quot;</span><span class="p">)],</span>
            <span class="c1"># Outputs</span>
            <span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">left_sector</span><span class="p">,</span> <span class="s2">&quot;low_selector_a&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">right_sector</span><span class="p">,</span> <span class="s2">&quot;low_selector_a&quot;</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">left_sector</span><span class="p">,</span> <span class="s2">&quot;low_selector_b&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">right_sector</span><span class="p">,</span> <span class="s2">&quot;low_selector_b&quot;</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">left_sector</span><span class="p">,</span> <span class="s2">&quot;high_selector_a&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">right_sector</span><span class="p">,</span> <span class="s2">&quot;high_selector_a&quot;</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">left_sector</span><span class="p">,</span> <span class="s2">&quot;high_selector_b&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">right_sector</span><span class="p">,</span> <span class="s2">&quot;high_selector_b&quot;</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="p">]</span>
        <span class="c1"># fmt: on</span>

        <span class="k">for</span> <span class="n">connection</span> <span class="ow">in</span> <span class="n">row_connections</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">blueprint</span><span class="o">.</span><span class="n">add_circuit_connection</span><span class="p">(</span><span class="o">*</span><span class="n">connection</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="c1"># Column connections</span>
    <span class="n">left_above_sector</span> <span class="o">=</span> <span class="s2">&quot;sector_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">left_below_sector</span> <span class="o">=</span> <span class="s2">&quot;sector_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>

    <span class="n">right_above_sector</span> <span class="o">=</span> <span class="s2">&quot;sector_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">right_below_sector</span> <span class="o">=</span> <span class="s2">&quot;sector_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>

    <span class="c1"># fmt: off</span>
    <span class="n">column_connections</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># Inputs</span>
        <span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">left_above_sector</span><span class="p">,</span> <span class="s2">&quot;low_selector_a&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">left_below_sector</span><span class="p">,</span> <span class="s2">&quot;low_selector_a&quot;</span><span class="p">)],</span>
        <span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">left_above_sector</span><span class="p">,</span> <span class="s2">&quot;low_selector_b&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">left_below_sector</span><span class="p">,</span> <span class="s2">&quot;low_selector_b&quot;</span><span class="p">)],</span>
        <span class="p">[</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">left_above_sector</span><span class="p">,</span> <span class="s2">&quot;low_gate_a&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">left_below_sector</span><span class="p">,</span> <span class="s2">&quot;low_gate_a&quot;</span><span class="p">)],</span>
        <span class="p">[</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">left_above_sector</span><span class="p">,</span> <span class="s2">&quot;low_gate_b&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">left_below_sector</span><span class="p">,</span> <span class="s2">&quot;low_gate_b&quot;</span><span class="p">)],</span>
        <span class="c1"># Ouputs</span>
        <span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">right_above_sector</span><span class="p">,</span> <span class="s2">&quot;low_selector_a&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">right_below_sector</span><span class="p">,</span> <span class="s2">&quot;low_selector_a&quot;</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">right_above_sector</span><span class="p">,</span> <span class="s2">&quot;low_selector_b&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">right_below_sector</span><span class="p">,</span> <span class="s2">&quot;low_selector_b&quot;</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">right_above_sector</span><span class="p">,</span> <span class="s2">&quot;high_selector_a&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">right_below_sector</span><span class="p">,</span> <span class="s2">&quot;high_selector_a&quot;</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">right_above_sector</span><span class="p">,</span> <span class="s2">&quot;high_selector_b&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">right_below_sector</span><span class="p">,</span> <span class="s2">&quot;high_selector_b&quot;</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">]</span>
    <span class="c1"># fmt: on</span>

    <span class="k">for</span> <span class="n">connection</span> <span class="ow">in</span> <span class="n">column_connections</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">blueprint</span><span class="o">.</span><span class="n">add_circuit_connection</span><span class="p">(</span><span class="o">*</span><span class="n">connection</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
</pre></div>
</div>
<p>And presto:</p>
<p>[img of just the sectors]</p>
<p>The remainder of the file creates the encoding and decoding portions of the blueprint for completeness’ sake, though they don’t work much further with groups and as such are largely uninteresting for the purpose of this document. Again, if you wish to see the uninterrupted implementation, you can take a look at <a class="reference external" href="https://github.com/redruin1/factorio-draftsman/blob/main/examples/1KiB_sector_ROM.py">the whole thing here</a>.</p>
<p>Hopefully that should give you a primer on how Groups work and how they are useful in a number of contexts. They allow for less boilerplate code, especially on large, complex structures, and they add an extra layer of abstraction to collect sets of entities together when they share a common trait or purpose. Groups can be translated, rotated, and flipped just like Blueprints as well, making them a versatile portion of the Draftsman’s tooklit.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="entities.html" class="btn btn-neutral float-left" title="Entities" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="modding.html" class="btn btn-neutral float-right" title="How to use mods with Draftsman" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, redruin1.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>